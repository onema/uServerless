/**
  * This file is part of the ONEMA lambda-mailer Package.
  * For the full copyright and license information,
  * please view the LICENSE file that was distributed
  * with this source code.
  *
  * copyright (c) 2018, Juan Manuel Torres (http://onema.io)
  *
  * @author Juan Manuel Torres <software@onema.io>
  */

package handler.function

import java.io.{ByteArrayInputStream, ByteArrayOutputStream}

import com.amazonaws.serverless.proxy.internal.testutils.MockLambdaContext
import handler.EnvironmentHelper
import org.scalamock.scalatest.MockFactory
import org.scalatest.{FlatSpec, Matchers}
import functions.process._

class LambdaHandlerTest extends FlatSpec with Matchers with MockFactory with EnvironmentHelper {

  "An SNS Message as an input stream" should "get decoded to an SNSMessageEvent" in {
    // Arrange
    val message = "{\"Records\":[{\"EventSource\":\"aws:sns\",\"EventVersion\":\"1.0\",\"EventSubscriptionArn\":\"arn:aws:sns:us-east-1:065150860170:dev-mail-forwarder:60e2f489-544d-4903-a6b3-84dba277ce35\",\"Sns\":{\"Type\":\"Notification\",\"MessageId\":\"9a8a2abc-c2aa-5b77-bade-79567e70ef08\",\"TopicArn\":\"arn:aws:sns:us-east-1:065150860170:dev-mail-forwarder\",\"Subject\":\"Amazon SES Email Receipt Notification\",\"Message\":\"{\\\"notificationType\\\":\\\"Received\\\",\\\"mail\\\":{\\\"timestamp\\\":\\\"2018-08-12T22:54:18.299Z\\\",\\\"source\\\":\\\"onema@ymail.com\\\",\\\"messageId\\\":\\\"3u1mvrms5m2qeh9glc47ik8b77c82fldaukjm181\\\",\\\"destination\\\":[\\\"software@onema.io\\\"],\\\"headersTruncated\\\":false,\\\"headers\\\":[{\\\"name\\\":\\\"Return-Path\\\",\\\"value\\\":\\\"<onema@ymail.com>\\\"},{\\\"name\\\":\\\"Received\\\",\\\"value\\\":\\\"from sonic302-4.consmr.mail.bf2.yahoo.com (sonic302-4.consmr.mail.bf2.yahoo.com [74.6.135.43]) by inbound-smtp.us-east-1.amazonaws.com with SMTP id 3u1mvrms5m2qeh9glc47ik8b77c82fldaukjm181 for software@onema.io; Sun, 12 Aug 2018 22:54:18 +0000 (UTC)\\\"},{\\\"name\\\":\\\"X-SES-Spam-Verdict\\\",\\\"value\\\":\\\"PASS\\\"},{\\\"name\\\":\\\"X-SES-Virus-Verdict\\\",\\\"value\\\":\\\"PASS\\\"},{\\\"name\\\":\\\"Received-SPF\\\",\\\"value\\\":\\\"pass (spfCheck: domain of _spf.mail.yahoo.com designates 74.6.135.43 as permitted sender) client-ip=74.6.135.43; envelope-from=onema@ymail.com; helo=sonic302-4.consmr.mail.bf2.yahoo.com;\\\"},{\\\"name\\\":\\\"Authentication-Results\\\",\\\"value\\\":\\\"amazonses.com; spf=pass (spfCheck: domain of _spf.mail.yahoo.com designates 74.6.135.43 as permitted sender) client-ip=74.6.135.43; envelope-from=onema@ymail.com; helo=sonic302-4.consmr.mail.bf2.yahoo.com; dkim=permerror header.i=@ymail.com;\\\"},{\\\"name\\\":\\\"X-SES-RECEIPT\\\",\\\"value\\\":\\\"AEFBQUFBQUFBQUFHUWcrV255RE0raUwzTHc3cWpuV3hpWisxWG5lSXlXTGpKUDRvWDVCQjc1cDZ6TkZWbWZ4SmI3ZGdsR2kzNS94ayt3L0s4L1dFZ0dpTHI4T2VOZDc1bVUwaDRvMUhlM1ZLVE0yWkZWRkVTR3VEMFNyeE9RUHRydlJ6UHU5QWhpc0YwY0E2MDZDRjE4MXdUZVlqRTBRQ2I3anp4UWZ1UWprV05ucFEwNGJDYWpUc1BWZGZsS0krT2VwZVVhWnRiYzNwb0c2VDdnV3QzRm5zSTFuNGV6MFhmQzc3eGRYSFN1dHdMRTJUOStIMU1wNi8zSE9zZHQ2RVJDdXhyeGg3TEd6d1FqN09LeWFTS3hKSUdzMGRDR1YyaCtRbitJN0llMVFZZlJicXBJaGFFbnc9PQ==\\\"},{\\\"name\\\":\\\"X-SES-DKIM-SIGNATURE\\\",\\\"value\\\":\\\"a=rsa-sha256; q=dns/txt; b=KTZzDozPWjvJB/lENOCfT4B1klJ7Po9yy2/cKEvR7LAyVMven2N/Xzt4h9I0lsczZTkmMNmoMpReK/jZEmmbz+sxnBuqs7BFM/a7sfZp1sINb/rGI2WzN+wt6idWZ4MjHp16rkL8yKJgSk3dhpo8Nt/cWaKqrnVzR2oliuSrLqg=; c=relaxed/simple; s=ug7nbtf4gccmlpwj322ax3p6ow6yfsug; d=amazonses.com; t=1534114458; v=1; bh=b/3Vu4+fMmlsRK2SgBnH9yTF6LxUkaqiYcNxl88tkcE=; h=From:To:Cc:Bcc:Subject:Date:Message-ID:MIME-Version:Content-Type:X-SES-RECEIPT;\\\"},{\\\"name\\\":\\\"DKIM-Signature\\\",\\\"value\\\":\\\"v=1; a=rsa-sha256; c=relaxed/relaxed; d=ymail.com; s=s2048; t=1534114457; bh=oURrpS3wauX3ZJN59roxDXLNjVJ3PPPmc9ZLaV7mvUI=; h=Date:From:To:Subject:References:From:Subject; b=B08czmHsA4o3XGtW3eIR8uKHujRWxKSdVG7bSJA0WoRl7arVNZN5pTF2DjEE1zlVNsMu980BBHt9DXMGAhxaY7MWcjHT3NPoPw99GMAniMSWPa/2PjHnnWPzpyXhMIiNgEUDCf1oRYfhpU/wRh77WlbWVnvF867Q8lyys4eOo1b7O4OSavE2sVw07go9LFObnesgPKrVzgqYoRBQY71BNMxPLv8ri1HbBMGth8EQpktRwjmJ3t7bRt5rkJjVH8gfKTLSpYtFEHvpf7m6eF3KtWxpXLgQ9m52VWDMt+ecussInSlrPdB4Vt+mlsSw+wkaoD6TcdQYqHPw9JWXsIQbWw==\\\"},{\\\"name\\\":\\\"X-YMail-OSG\\\",\\\"value\\\":\\\"TWqNO_0VM1n8_MwtxLNRx4IfUHJ3sd01m1teSb6LyZU5QsxxoDLVYzn_d.Cq_0k Qy8OheiPIDh6NoSH1vyINGDVxNcHAkRIq5z3DoS21g8HLSGJX2zx4ejVEXcxLTykH41_dLzBvUMt yemwRtZc_1hJCj1H5abjeRw4NiuAFBer0AHE83EO1oqP34CqllBWGStZ3Aj3wBqWWe8SnppY38oJ qylXc6.0pJpV43w.uToc2Z.D37kcVMrijMqmAHT0_i8.PaZE8FaT_iCxAKEog_ovl7hpsMDDe1.V CLABngxiSSK8KwDpx0lW_3w.0YNyhESSqwXdLMGYrcaNF.Re25rMlng_rlL89PTtT2_yRHKcQ36k iTA9NlTfkgbWLpJZmsXi37QDyw1ZNSLfXXIIOw9W4G6mYB_PcOOPkYxf2z2IpE9f6VKcHXcS6HJF u3UKPn_HHbYUx5ISuo1mTKdsTXHeFwnDtEjWWuWGv93ZPyHeG.VZAZhfB1y2WFVcwF7Kp5UYGZ2T QTb6WnFKFt9xE1vpv4ZFhMAfv.CxdSWPXxxRnnRIBuEgvvVAtTdnlmshpBQ11sysm4OF8TOCAZsS XOmbgKt1C95XIS6GmyaI.8ica00OfxmOO8UH108rrKFIo1uE03tA2f._Dj8cGbK6_iIY5PjsGGPc EuOAL.glink7gfdnM9CpvLbVvSqw_Sw6YokkP07jaS8e6bjmIyZxsjEJjSBOg3bT2oap1CrrZTRa _xisFVT7dAQFmGiHnZAJXoxsem_6JRvj6SGdAGtk5dfZ3MrkE2QcfnS8DXAyEqLtRVug0aqPlalU jkZS8H0P72btNO.qnc5RShTrmkfiD_1MOmgaUcy.J44WJ710uz3wKjdIPXP1mxsCfY1UX3rKa3Ob AInO8G7SemGdein1BcG36HrgTjw8Pjs.ODrHjQJHDVJe3p7ux5pfYJcRDQQFsM_qLCsbaMJqo9HF rRjMckvE4dSqikAkglhM1AQfWJ.E1HnVcNTXMeWtEdlS_7MOmjPNf_ChDiAyu\\\"},{\\\"name\\\":\\\"Received\\\",\\\"value\\\":\\\"from sonic.gate.mail.ne1.yahoo.com by sonic302.consmr.mail.bf2.yahoo.com with HTTP; Sun, 12 Aug 2018 22:54:17 +0000\\\"},{\\\"name\\\":\\\"Date\\\",\\\"value\\\":\\\"Sun, 12 Aug 2018 22:54:15 +0000 (UTC)\\\"},{\\\"name\\\":\\\"From\\\",\\\"value\\\":\\\"Juan Torres <onema@ymail.com>\\\"},{\\\"name\\\":\\\"To\\\",\\\"value\\\":\\\"\\\\\\\"software@onema.io\\\\\\\" <software@onema.io>\\\"},{\\\"name\\\":\\\"Message-ID\\\",\\\"value\\\":\\\"<1528587585.6253634.1534114455778@mail.yahoo.com>\\\"},{\\\"name\\\":\\\"Subject\\\",\\\"value\\\":\\\"test with new serverless base framework\\\"},{\\\"name\\\":\\\"MIME-Version\\\",\\\"value\\\":\\\"1.0\\\"},{\\\"name\\\":\\\"Content-Type\\\",\\\"value\\\":\\\"multipart/alternative;  boundary=\\\\\\\"----=_Part_6253633_1837974252.1534114455777\\\\\\\"\\\"},{\\\"name\\\":\\\"References\\\",\\\"value\\\":\\\"<1528587585.6253634.1534114455778.ref@mail.yahoo.com>\\\"},{\\\"name\\\":\\\"X-Mailer\\\",\\\"value\\\":\\\"WebService/1.1.12206 YMailNorrin Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36\\\"},{\\\"name\\\":\\\"Content-Length\\\",\\\"value\\\":\\\"1385\\\"}],\\\"commonHeaders\\\":{\\\"returnPath\\\":\\\"onema@ymail.com\\\",\\\"from\\\":[\\\"Juan Torres <onema@ymail.com>\\\"],\\\"date\\\":\\\"Sun, 12 Aug 2018 22:54:15 +0000 (UTC)\\\",\\\"to\\\":[\\\"\\\\\\\"software@onema.io\\\\\\\" <software@onema.io>\\\"],\\\"messageId\\\":\\\"<1528587585.6253634.1534114455778@mail.yahoo.com>\\\",\\\"subject\\\":\\\"test with new serverless base framework\\\"}},\\\"receipt\\\":{\\\"timestamp\\\":\\\"2018-08-12T22:54:18.299Z\\\",\\\"processingTimeMillis\\\":447,\\\"recipients\\\":[\\\"software@onema.io\\\"],\\\"spamVerdict\\\":{\\\"status\\\":\\\"PASS\\\"},\\\"virusVerdict\\\":{\\\"status\\\":\\\"PASS\\\"},\\\"spfVerdict\\\":{\\\"status\\\":\\\"PASS\\\"},\\\"dkimVerdict\\\":{\\\"status\\\":\\\"PROCESSING_FAILED\\\"},\\\"dmarcVerdict\\\":{\\\"status\\\":\\\"PASS\\\"},\\\"action\\\":{\\\"type\\\":\\\"SNS\\\",\\\"topicArn\\\":\\\"arn:aws:sns:us-east-1:065150860170:dev-mail-forwarder\\\",\\\"encoding\\\":\\\"UTF8\\\"}},\\\"content\\\":\\\"Return-Path: <onema@ymail.com>\\\\r\\\\nReceived: from sonic302-4.consmr.mail.bf2.yahoo.com (sonic302-4.consmr.mail.bf2.yahoo.com [74.6.135.43])\\\\r\\\\n by inbound-smtp.us-east-1.amazonaws.com with SMTP id 3u1mvrms5m2qeh9glc47ik8b77c82fldaukjm181\\\\r\\\\n for software@onema.io;\\\\r\\\\n Sun, 12 Aug 2018 22:54:18 +0000 (UTC)\\\\r\\\\nX-SES-Spam-Verdict: PASS\\\\r\\\\nX-SES-Virus-Verdict: PASS\\\\r\\\\nReceived-SPF: pass (spfCheck: domain of _spf.mail.yahoo.com designates 74.6.135.43 as permitted sender) client-ip=74.6.135.43; envelope-from=onema@ymail.com; helo=sonic302-4.consmr.mail.bf2.yahoo.com;\\\\r\\\\nAuthentication-Results: amazonses.com;\\\\r\\\\n spf=pass (spfCheck: domain of _spf.mail.yahoo.com designates 74.6.135.43 as permitted sender) client-ip=74.6.135.43; envelope-from=onema@ymail.com; helo=sonic302-4.consmr.mail.bf2.yahoo.com;\\\\r\\\\n dkim=permerror header.i=@ymail.com;\\\\r\\\\nX-SES-RECEIPT: AEFBQUFBQUFBQUFHUWcrV255RE0raUwzTHc3cWpuV3hpWisxWG5lSXlXTGpKUDRvWDVCQjc1cDZ6TkZWbWZ4SmI3ZGdsR2kzNS94ayt3L0s4L1dFZ0dpTHI4T2VOZDc1bVUwaDRvMUhlM1ZLVE0yWkZWRkVTR3VEMFNyeE9RUHRydlJ6UHU5QWhpc0YwY0E2MDZDRjE4MXdUZVlqRTBRQ2I3anp4UWZ1UWprV05ucFEwNGJDYWpUc1BWZGZsS0krT2VwZVVhWnRiYzNwb0c2VDdnV3QzRm5zSTFuNGV6MFhmQzc3eGRYSFN1dHdMRTJUOStIMU1wNi8zSE9zZHQ2RVJDdXhyeGg3TEd6d1FqN09LeWFTS3hKSUdzMGRDR1YyaCtRbitJN0llMVFZZlJicXBJaGFFbnc9PQ==\\\\r\\\\nX-SES-DKIM-SIGNATURE: a=rsa-sha256; q=dns/txt; b=KTZzDozPWjvJB/lENOCfT4B1klJ7Po9yy2/cKEvR7LAyVMven2N/Xzt4h9I0lsczZTkmMNmoMpReK/jZEmmbz+sxnBuqs7BFM/a7sfZp1sINb/rGI2WzN+wt6idWZ4MjHp16rkL8yKJgSk3dhpo8Nt/cWaKqrnVzR2oliuSrLqg=; c=relaxed/simple; s=ug7nbtf4gccmlpwj322ax3p6ow6yfsug; d=amazonses.com; t=1534114458; v=1; bh=b/3Vu4+fMmlsRK2SgBnH9yTF6LxUkaqiYcNxl88tkcE=; h=From:To:Cc:Bcc:Subject:Date:Message-ID:MIME-Version:Content-Type:X-SES-RECEIPT;\\\\r\\\\nDKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ymail.com; s=s2048; t=1534114457; bh=oURrpS3wauX3ZJN59roxDXLNjVJ3PPPmc9ZLaV7mvUI=; h=Date:From:To:Subject:References:From:Subject; b=B08czmHsA4o3XGtW3eIR8uKHujRWxKSdVG7bSJA0WoRl7arVNZN5pTF2DjEE1zlVNsMu980BBHt9DXMGAhxaY7MWcjHT3NPoPw99GMAniMSWPa/2PjHnnWPzpyXhMIiNgEUDCf1oRYfhpU/wRh77WlbWVnvF867Q8lyys4eOo1b7O4OSavE2sVw07go9LFObnesgPKrVzgqYoRBQY71BNMxPLv8ri1HbBMGth8EQpktRwjmJ3t7bRt5rkJjVH8gfKTLSpYtFEHvpf7m6eF3KtWxpXLgQ9m52VWDMt+ecussInSlrPdB4Vt+mlsSw+wkaoD6TcdQYqHPw9JWXsIQbWw==\\\\r\\\\nX-YMail-OSG: TWqNO_0VM1n8_MwtxLNRx4IfUHJ3sd01m1teSb6LyZU5QsxxoDLVYzn_d.Cq_0k\\\\r\\\\n Qy8OheiPIDh6NoSH1vyINGDVxNcHAkRIq5z3DoS21g8HLSGJX2zx4ejVEXcxLTykH41_dLzBvUMt\\\\r\\\\n yemwRtZc_1hJCj1H5abjeRw4NiuAFBer0AHE83EO1oqP34CqllBWGStZ3Aj3wBqWWe8SnppY38oJ\\\\r\\\\n qylXc6.0pJpV43w.uToc2Z.D37kcVMrijMqmAHT0_i8.PaZE8FaT_iCxAKEog_ovl7hpsMDDe1.V\\\\r\\\\n CLABngxiSSK8KwDpx0lW_3w.0YNyhESSqwXdLMGYrcaNF.Re25rMlng_rlL89PTtT2_yRHKcQ36k\\\\r\\\\n iTA9NlTfkgbWLpJZmsXi37QDyw1ZNSLfXXIIOw9W4G6mYB_PcOOPkYxf2z2IpE9f6VKcHXcS6HJF\\\\r\\\\n u3UKPn_HHbYUx5ISuo1mTKdsTXHeFwnDtEjWWuWGv93ZPyHeG.VZAZhfB1y2WFVcwF7Kp5UYGZ2T\\\\r\\\\n QTb6WnFKFt9xE1vpv4ZFhMAfv.CxdSWPXxxRnnRIBuEgvvVAtTdnlmshpBQ11sysm4OF8TOCAZsS\\\\r\\\\n XOmbgKt1C95XIS6GmyaI.8ica00OfxmOO8UH108rrKFIo1uE03tA2f._Dj8cGbK6_iIY5PjsGGPc\\\\r\\\\n EuOAL.glink7gfdnM9CpvLbVvSqw_Sw6YokkP07jaS8e6bjmIyZxsjEJjSBOg3bT2oap1CrrZTRa\\\\r\\\\n _xisFVT7dAQFmGiHnZAJXoxsem_6JRvj6SGdAGtk5dfZ3MrkE2QcfnS8DXAyEqLtRVug0aqPlalU\\\\r\\\\n jkZS8H0P72btNO.qnc5RShTrmkfiD_1MOmgaUcy.J44WJ710uz3wKjdIPXP1mxsCfY1UX3rKa3Ob\\\\r\\\\n AInO8G7SemGdein1BcG36HrgTjw8Pjs.ODrHjQJHDVJe3p7ux5pfYJcRDQQFsM_qLCsbaMJqo9HF\\\\r\\\\n rRjMckvE4dSqikAkglhM1AQfWJ.E1HnVcNTXMeWtEdlS_7MOmjPNf_ChDiAyu\\\\r\\\\nReceived: from sonic.gate.mail.ne1.yahoo.com by sonic302.consmr.mail.bf2.yahoo.com with HTTP; Sun, 12 Aug 2018 22:54:17 +0000\\\\r\\\\nDate: Sun, 12 Aug 2018 22:54:15 +0000 (UTC)\\\\r\\\\nFrom: Juan Torres <onema@ymail.com>\\\\r\\\\nTo: \\\\\\\"software@onema.io\\\\\\\" <software@onema.io>\\\\r\\\\nMessage-ID: <1528587585.6253634.1534114455778@mail.yahoo.com>\\\\r\\\\nSubject: test with new serverless base framework\\\\r\\\\nMIME-Version: 1.0\\\\r\\\\nContent-Type: multipart/alternative; \\\\r\\\\n\\\\tboundary=\\\\\\\"----=_Part_6253633_1837974252.1534114455777\\\\\\\"\\\\r\\\\nReferences: <1528587585.6253634.1534114455778.ref@mail.yahoo.com>\\\\r\\\\nX-Mailer: WebService/1.1.12206 YMailNorrin Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36\\\\r\\\\nContent-Length: 1385\\\\r\\\\n\\\\r\\\\n------=_Part_6253633_1837974252.1534114455777\\\\r\\\\nContent-Type: text/plain; charset=UTF-8\\\\r\\\\nContent-Transfer-Encoding: quoted-printable\\\\r\\\\n\\\\r\\\\nfor scalafoo=C2=A0barbaz\\\\r\\\\n  Via =20\\\\r\\\\n\\\\r\\\\n\\\\r\\\\n------=_Part_6253633_1837974252.1534114455777\\\\r\\\\nContent-Type: text/html; charset=UTF-8\\\\r\\\\nContent-Transfer-Encoding: 7bit\\\\r\\\\n\\\\r\\\\n<html><head></head><body><div style=\\\\\\\"font-family:Helvetica Neue, Helvetica, Arial, sans-serif;font-size:13px;\\\\\\\"><div>for scala</div><div>foo&nbsp;</div><div>bar</div><div>baz</div><div><div><br></div><div class=\\\\\\\"yahoo-gif-wrapper\\\\\\\" contenteditable=\\\\\\\"false\\\\\\\">\\\\r\\\\n               <a rel=\\\\\\\"noreferrer\\\\\\\" target=\\\\\\\"_blank\\\\\\\" href=\\\\\\\"https://tenor.com/Zzpf.gif\\\\\\\" style=\\\\\\\"cursor:pointer;text-decoration: none;color:transparent\\\\\\\"><img title=\\\\\\\"William Shatner Tos GIF\\\\\\\" alt=\\\\\\\"William Shatner Tos GIF\\\\\\\" src=\\\\\\\"https://media.tenor.com/images/b9d1205cc5a27c64af4e6d5006c54f82/tenor.gif\\\\\\\" class=\\\\\\\"yahoo-inline-image yahoo-online-gif\\\\\\\" data-id=\\\\\\\"1534114449740\\\\\\\" draggable=\\\\\\\"false\\\\\\\">\\\\r\\\\n                   <div style=\\\\\\\"font-size:11px;color:#979ba7;margin-top:8px;font-family:Arial\\\\\\\" class=\\\\\\\"rte-gif-attribution\\\\\\\">Via <img src=\\\\\\\"https://s.yimg.com/nq/gif-providers/1/gif-providers/tenor.png\\\\\\\" data-inlineimagemanipulating=\\\\\\\"true\\\\\\\" class=\\\\\\\"\\\\\\\"></div>\\\\r\\\\n               </a></div><div><br></div><br></div><div style=\\\\\\\"font-family:Helvetica Neue, Helvetica, Arial, sans-serif;font-size:13px;\\\\\\\"></div></div></body></html>\\\\r\\\\n------=_Part_6253633_1837974252.1534114455777--\\\\r\\\\n\\\"}\",\"Timestamp\":\"2018-08-12T22:54:18.816Z\",\"SignatureVersion\":\"1\",\"Signature\":\"EaWq+C4NC0F3JikHWaZgFBns7YC2advp3bMOe1F0F4jcyxFgyj8L2Fa7sCUmxvnpOkX733/p7VV/K7baBYruSCrOGnQ0W+Td5eeB8X1vhpSAVS0AVG5GiPwTSUwnodRqWbjRTQk+STkt/dKwAZDB9k/OyQjGys4qzi6Q5U6p54g2qgXdUyqv/n9McIl2yrXhNIhDpxTr2+38Pjk4edUhFuaHUtQySbUk6mpkbnRkJ0ly7ZSEaHCcb3ZQUSCGTMR3aSnxDwUf0Of5ToiCJePe6vnibZXR7XdDXhuw6ZPhZJEsjuAZOKpvzSJAc2bLTVq78yGE5T7UUcpY+7O5AXl8BA==\",\"SigningCertUrl\":\"https://sns.us-east-1.amazonaws.com/SimpleNotificationService-eaea6120e66ea12e88dcd8bcbddca752.pem\",\"UnsubscribeUrl\":\"https://sns.us-east-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:us-east-1:065150860170:dev-mail-forwarder:60e2f489-544d-4903-a6b3-84dba277ce35\",\"MessageAttributes\":{}}}]}"
    val inputStream = new ByteArrayInputStream(message.getBytes())
    val outputStream = new ByteArrayOutputStream()
    val context = new MockLambdaContext
    val function = new Function()

    // Act
    function.lambdaHandler(inputStream, outputStream, context)


    // Assert
  }
}
